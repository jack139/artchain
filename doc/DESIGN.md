
## 设计说明

艺术链平台实现区块链上的艺术品拍卖。

1. 平台涉及以下利益相关者：

* 买卖双方（TRD）
* 银行（BNK）
* 保险公司（INS）
* 拍卖行（AH）
* 艺术品经销商（DEL）
* 艺术家（ART）
* 评论家（REV）



2. 拍卖方式分为：**立即购买**方式和**竞价拍卖**方式，均为限时拍卖。



## 设计目标

### 1. 一条链存储数据：物品、人、事件

物品：登记物品、评价、认证信息、所有权转移、价格变化

人：拍卖行、交易者、担保者、鉴别者、保险公司，各自账户与代币权益绑定

事件：拍卖事件、拍卖过程、成交交易、所有权转移

### 2. 物品标识

单一物品使用NFT标识，整体交易时转移NFT所有权。

拆分交易时，由NFT对应若干数字证书，交易者持有数字证书，NFT所有权由平台代持。

### 3. 通证

#### （1）信用通证

**用途：**用于产生劳动价值的收益（交易、评价、担保、鉴别等事件），可用于支付平台手续费、信用抵押。

**产生方法：**由平台自动挖矿产生

#### （2）抵押通证

**用途：**与法币挂钩，用于拍卖竞价、交易担保、物品交易

**产生方法：**实物抵押或现金抵押产生，抵押解除后销毁

### 4. 开放平台方式部署

授权机构可以部署自己的区块链节点（共识节点或复制节点），节点本地支持开放API，授权结构可以使用开放API构建自己的交易系统入口。物品数据、交易数据可以在链上与其他授权机构共享，形成统一数据。





## 流程设计

### 1. 人员注册

艺术家、商人、或经销商拥有**物品**（资产）。艺术家、评论家、拍卖行会对物品进行专业鉴定和评价。拍卖行、银行、保险公司和服务提供商在拍卖过程中发挥着各自的作用。为了在区块链上开展业务，利益相关者必须在区块链上开设一个账户。上述列出的各种利益相关者，每个利益相关者都有不同的兴趣。



### 2. 物品注册

拥有**物品**的卖方（商人）必须在区块链上注册物品才能开展业务。提交**物品**进行注册时，将执行以下操作：

   * 检查所有者是否具有注册帐户
   * 将任何显示的“真实性证书”或可信发布的图像转换为字节流，生成密钥，使用该密钥对字节流进行加密并将图像存储在区块链上
   * 向**所有者**提供密钥（NFT），并确保安全保存，以备将来使用
   * 在物品历史记录中记录，以便可以随时查看物品的生命周期 



### 3. 物品评价

经过平台认证的艺术家、评论家、拍卖行可以对注册的物品进行鉴定和评价，并记录在链上。用于买家购买时作为参考。并建立适当机制对评价可信度进行评分，对评价作者进行评分。



### 5. 拍卖

#### （1）提出拍卖请求

当物品的所有者想拍卖该物品时， 他们可以选择一个拍卖行，并提出“要求拍卖”物品的请求。该请求始终指定一个“**底价**”。 如果同时使用“**立即购买**”方式，所有者可以指定一个“**立即购买**”价格。提出请求后，物品、所有者和拍卖行都将得到区块链验证。

拍卖行很可能会在幕后获得资产的身份验证，并在决定接受该物品之前确定估值。 他们可以请求**卖方**将其密钥、帐户ID和注册的项目号输入到客户端应用程序中。项目编号和帐户标识符可以直接验证，密钥将用于解密和检索存储的“真实性或图像证书”。此时，拍卖的状态将设置为**INIT**，直到拍卖行准备好**OPEN**竞标资产为止。



#### （2）开启竞价拍卖

拍卖将选择一个时间范围来放置该物品进行拍卖，并**OPEN**它以接受潜在买家的出价。 他们可能会在广告中宣传**“立即购买”**价格。



#### （3）“立即购买”并接受出价

在拍卖窗口期中，潜在买家可以出价。 如果买家希望执行“**立即购买**”，只要所有出价中没有高于**“立即购买”**价格的出价，他们便可以立即购买。

满足下述要求，买家的出价将被平台接受：

   * 出价等于或大于**底价**
   * 拍卖仍为**OPEN**
   * 买方有一个注册帐户



#### (4) 立即购买

当买家选择此选项时，平台会执行以下操作：

   * 验证买方身份
   * 检查是否有任何出价者的出价高于**“立即购买”**价格。 如果有，则报价被拒绝
   * 如果适用**“立即购买”**价格，则立即**CLOSE**拍卖，进行此**交易**
   * 将资产分配给新所有者
   * 生成新的“密钥”，重新加密“所有权证书或图像”，并将密钥提供给新买家
   * 资产的新价格设置为**“立即购买”**价格



#### （5）拍卖到期

拍卖到期后，拍卖行会取回最高出价并将其转换为一笔**交易**（在现实世界中，交易可能意味着创建保险和运输文件，收取付款和佣金，向交易商签发新的名称或证书给新所有者等），将所有权转让给买方，并以新的**最终**价格更新为物品的价格。它还会生成一个新的“密钥”，重新加密“所有权证书或图像”，并将密钥提供给新买家。



### 6. 交易成交

成交的交易会记录在区块链上，同时进行上述所有权的转移。



### 7. 将所有权转移给另一个用户

不经过拍卖交易，平台也允许资产的**所有者**将**所有权**转让给另一个人，转移由物品所有人发起。接收人必须已在区块链上注册。当前，平台不执行任何法规或合规性规则检查。（可能适用于线下的交易场景）



### 8. 验证资产所有权

平台通过请求验证方输入其**私钥**、帐户ID和注册物品号来进行初步身份验证。物品编号和帐户标识符可以直接验证，密钥将用于解密和查看所存储的**“真实性或图像证书”**。如果解密失败，则假定所有者不是资产的合法所有者。



## 链上数据结构设计

### 1. 人员信息

```
UserID    // 用户id
RecType   // Type = USER
Name      // 姓名
UserType  // 用户类型: TRD, BANK, AH, DEL, ART, REV
Address   // 地址
Phone     // 电话
Email     // 邮件
Bank      // 银行
AccountNo // 银行账号
Status    // 用户状态： ACTIVE, CLOSE, FORBID, WAIT
UserDate  // 注册日期
```


### 2. 物品信息

```
ItemID         // 物品编号
RecType        // ARTINV
ItemDesc       // 物品描述
ItemDetail     // 物品细节描述
ItemDate       // 物品出现年代
ItemType       // 类型：原作、复制品
ItemSubject    // 主题：古代、现代、风景、雕塑、人像，等等
ItemMedia      // 材质：石头、金属、瓷器、油画、素描、等等
ItemSize       // 尺寸
ItemImage      // 数字照片信息（存储在IPFS）
AESKey         // 物品密钥
ItemBasePrice  // 最近交易价格
CurrentOwnerID // 所有人信息
```

### 4. 评价信息

```
ItemID         // 物品编号
RecType        // REVIEW
ReviewerID     // 评论者 user id
ReviewDetail   // 评价内容
ReviewDate     // 评论时间
Up             // 支持数量
Down           // 反对数量
```



### 5. 拍卖请求信息
```
AuctionID       // 拍卖 ID
RecType         // AUCREQ
ItemID          // 物品编号
AuctionHouseID  // 拍卖行ID
SellerID        // 卖家ID（须与物品所有者ID一致）
RequestDate     // 请求日期
ReservePrice    // 底价
Status          // 拍卖状态：INIT, OPEN, CLOSED  (由拍卖行设置)
OpenDate        // OPEN的日期 (由拍卖行设置)
CloseDate       // CLOSE的日期  (由拍卖行设置)
```



### 6. 出价信息

```
AuctionID  // 拍卖ID
RecType    // BID
BidNo      // 出价编号（自动生成）
AuctionID  // 拍卖编号
BuyerID    // 买家ID（须与物品所有者ID不同）
BidPrice   // 出价（须大于前一次出价）
BidTime    // 出价时间
```



### 7. 交易信息

```
AuctionID    // 拍卖ID
RecType      // POSTTRAN
ItemID       // 物品ID
TransType    // 交易类型：立即购买、竞价
UserId       // 买家ID
TransDate    // 成交时间
HammerTime   // 买家出价时间（成交价格出价）
HammerPrice  // 成交价格
Details      // 交易细节记录
```



## 接口功能设计

### 1. 人员



### 2. 物品



### 3. 拍卖



### 4. 交易



### 5. 查询




## 备注

1. 每个数据都有creator，只有creator能修改数据
2. 每个数据的creator都是数据的实际所有者
3. 管理员账户可以创建用户，但是一旦创建，不能修改用户内容，只能修改用户状态
5. 审核人员/管理员可以使用creator身份修改数据
6. lastDate 字段记录修改记录，包括：creator的修改，审核/管理人员的修改
  User 的 creator 是 user自己
  Item 的 creator 是 caller
  Review 的 creator 是 reviwer自己
  Auction 的 creator 是 seller自己
  Trans 的 creator 是 caller



## TODO
1. API启动时，从链上下载可显示数据到redis（需解决多节点数据更新时，对redis的刷新）
2. 所有显示的查询均从redis中查询
3. 将拍卖行单独管理，一个拍卖行可以有多个管理员
